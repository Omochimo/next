<!DOCTYPE html>
<html lang="ja">
<head><link rel="stylesheet" href="style.css"><a href="about.html">このサイトについて</a>
  <form action="https://formspree.io/f/xxxx" method="POST">
  <input name="email" placeholder="メール">
  <textarea name="message" placeholder="メッセージ"></textarea>
  <button>送信</button>
</form>
<meta charset="utf-8"><title>構造体</title></head>
<body>
  <h1>現在キャスト選別中</h1>
  <p>登録順にご案内します。</p>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>登録ページ</title>
<style>
body{font-family:sans-serif;background:#f8f8f8;text-align:center;padding:50px;}
input,button{margin:8px;padding:10px;font-size:16px;}
</style>
</head>
<body>
  <h2>招待コード登録</h2>
  <input id="invite" placeholder="招待コード"><br>
  <input id="email" placeholder="メールアドレス"><br>
  <button onclick="register()">登録</button>
  <p id="msg"></p>

  <script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL = "https://omochimo.github.io/next/.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlndmRvY3pua2hicHFwZXVlbW5sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MDYzMzksImV4cCI6MjA3NzI4MjMzOX0.8Pqqjm62nEfA8srRwtqS7Znk1TExU-PHvtxjFOYpEDw";

  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

  async function register() {
    const invite = document.getElementById("invite").value.trim();
    const email = document.getElementById("email").value.trim();
    const msg = document.getElementById("msg");

    if(!invite || !email){ msg.textContent="入力が足りません。"; return; }

    // Magic Linkメール送信
    const { error } = await supabase.auth.signInWithOtp({
      email,
      options:{
        emailRedirectTo: "https://omochimo.github.io/next/otp.html"
      }
    });
    if(error){
      msg.textContent = "エラー: " + error.message;
    } else {
      msg.textContent = "確認メールを送信しました。メール内リンクをクリックしてください。";
    }
  }
  </script>
</body>
</html>
